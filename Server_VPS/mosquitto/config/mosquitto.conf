pid_file /var/run/mosquitto/mosquitto.pid
persistence true
persistence_location /mosquitto/data/
autosave_interval 1800

# ============================================================================
# LOGGING
# ============================================================================
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ACL
acl_file /mosquitto/acl/acl.conf

# ============================================================================
# LISTENER 1: Gateway mTLS (Port 8883)
# ============================================================================
listener 8883
protocol mqtt

cafile /mosquitto/certs/ca.cert.pem
certfile /mosquitto/certs/server.cert.pem
keyfile /mosquitto/certs/server.key.pem

require_certificate true
use_identity_as_username true
tls_version tlsv1.2

# ============================================================================
# LISTENER 2: Internal/Testing (Port 1883) - OPTIONAL
# ============================================================================
listener 1883
protocol mqtt
password_file /mosquitto/passwd/passwd

# ============================================================================
# SECURITY
# ============================================================================
allow_anonymous false
max_connections -1
max_queued_messages 1000

# ============================================================================
# PERFORMANCE
# ============================================================================
max_inflight_messages 20
max_queued_bytes 0
message_size_limit 0
set_tcp_nodelay true

# ============================================================================
# WEBSOCKETS (Optional - for web clients)
# ============================================================================
# listener 9001
# protocol websockets
# cafile /mosquitto/certs/ca.cert.pem
# certfile /mosquitto/certs/server.cert.pem
# keyfile /mosquitto/certs/server.key.pem