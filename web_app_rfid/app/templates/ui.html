
<!doctype html>
  <html lang="vi">
  <head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Gateway UI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}">
  </head>
  <body>
  <!-- Modal ƒëƒÉng nh·∫≠p -->
    <div id="login_backdrop" class="modal-backdrop show-modal">
      <div class="modal">
        <h3>ƒêƒÉng nh·∫≠p Gateway</h3>
        <div class="row"><input id="login_user" placeholder="T√†i kho·∫£n (vd: user_001)"></div>
        <div class="row"><input id="login_pass" type="password" placeholder="M·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p"></div>
        <div class="modal-actions">
          <button onclick="submitLogin()">ƒêƒÉng nh·∫≠p</button>
        </div>
        <div class="muted" id="login_hint"></div>
      </div>
    </div>
  


  <!-- Toast -->

  <!-- Modal chi ti·∫øt 1 log RFID -->
  <div id="log_backdrop" class="modal-backdrop">
    <div class="modal">
      <h3>Chi ti·∫øt l∆∞·ª£t v√†o/ra</h3>
      <div class="row"><div class="muted">UID</div><div id="lg_uid"></div></div>
      <div class="row"><div class="muted">Owner</div><div id="lg_owner"></div></div>
      <div class="row"><div class="muted">Device</div><div id="lg_device"></div></div>
      <div class="row"><div class="muted">K·∫øt qu·∫£</div><div id="lg_result"></div></div>
      <div class="row"><div class="muted">Th·ªùi gian</div><div id="lg_time"></div></div>
      <div class="modal-actions">
        <button class="secondary" onclick="closeLogModal()">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal th√™m/s·ª≠a (form) -->
<div id="rfid_modal" class="modal-backdrop">
  <div class="modal">
    <h3 id="rfid_modal_title">Th√¥ng tin th·∫ª</h3>

    <div class="row"><input id="f_uid" placeholder="UID (hex)" readonly></div>
    <div class="row"><input id="f_owner" value="00001" placeholder="Ch·ªß th·∫ª (Owner)"></div>
    <div class="row"><input id="f_type" placeholder="Card type" value="MIFARE Classic"></div>
    <div class="row"><input id="f_desc" placeholder="M√¥ t·∫£"></div>
    <div class="row">
      <input type="datetime-local" id="f_expires" placeholder="H·∫øt h·∫°n (tu·ª≥ ch·ªçn)">
    </div>
    <div class="row">
      <label><input type="checkbox" id="f_active" checked> Active</label>
    </div>

    <div class="modal-actions">
      <button class="secondary" onclick="closeEditModal()">ƒê√≥ng</button>
      <button onclick="saveRfid()">L∆∞u</button>
    </div>

    <div class="muted" id="rfid_hint"></div>
  </div>
</div>


  <!-- Modal x√°c nh·∫≠n xo√° -->
  <div id="confirm_backdrop" class="modal-backdrop">
    <div class="modal">
      <h3>Xo√° th·∫ª</h3>
      <div class="muted" id="confirm_text">B·∫°n ch·∫Øc mu·ªën xo√°?</div>
      <div class="modal-actions">
        <button class="secondary" onclick="closeConfirm()">H·ªßy</button>
        <button onclick="confirmDelete()">Xo√°</button>
      </div>
    </div>
  </div>

  <!-- Popup ch·ªù qu√©t RFID (Enroll mode) -->
  <div id="scan_backdrop" class="modal-backdrop">
    <div class="modal">
      <h3>Th√™m th·∫ª RFID</h3>
      <div class="muted" id="scan_status"><span class="spinner"></span>ƒêang ch·ªù b·∫°n qu√©t th·∫ª‚Ä¶</div>
      <div class="modal-actions">
        <button class="secondary" onclick="closeScanModal()">H·ªßy</button>
      </div>
    </div>
  </div>

  <div class="phone">
    <header class="topbar">
      <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
      <h1>Gateway Control</h1>

      <div id="menu" class="menu-dropdown">
        <div class="tab" data-tab="dashboard">Dashboard</div>
        <div class="tab" data-tab="passkey">Passkey</div>
        <div class="tab" data-tab="fan">Qu·∫°t</div>
        <div class="tab" data-tab="notify">Th√¥ng b√°o</div>
        <div class="tab" data-tab="rfid">RFID</div>
        <div class="tab" data-tab="history">L·ªãch s·ª≠ v√†o/ra</div>
        <div class="tab" data-tab="logout">ƒêƒÉng xu·∫•t</div>

      </div>
    </header>




    <!-- Tabs -->
    <!-- <nav id="menu" class="menu">
  <div class="tab active" data-tab="dashboard">Dashboard</div>
  <div class="tab" data-tab="passkey">Passkey</div>
  <div class="tab" data-tab="fan">Qu·∫°t</div>
  <div class="tab" data-tab="notify">Th√¥ng b√°o</div>
  <div class="tab" data-tab="rfid">RFID</div>
  <div class="tab" data-tab="history">L·ªãch s·ª≠ v√†o/ra</div>
</nav> -->

  <!-- DASHBOARD TAB -->
  <section id="tab-dashboard">
    <div class="card" id="dashboard_card">
    <h2>Dashboard gi√°m s√°t</h2>
       <div class="weather-box">
      <div class="weather-left">
        <div id="weather_icon" class="weather-icon">‚òÄÔ∏è</div>
        <div class="weather-temp">
          <span id="temp_value" class="temp-value">--¬∞C</span>
          <span id="hum_value" class="hum-value">--%</span>
        </div>
      </div>
      <div class="weather-info">
        <p id="temp_time" class="temp-time">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        <p id="location_info" class="location-info">Thi·∫øt b·ªã: --</p>
      </div>
    </div>

    <!-- Bi·ªÉu ƒë·ªì -->
    <div class="chart-section">
      <div class="chart-header">
        <label class="muted">üìà Bi·ªÉu ƒë·ªì nhi·ªát ƒë·ªô v√† ƒë·ªô ·∫©m</label>
        <select id="temp_range" onchange="loadTemperatureChart()">
          <option value="day">Trong ng√†y</option>
          <option value="week">Trong tu·∫ßn</option>
          <option value="month">Trong th√°ng</option>
        </select>
      </div>
      <canvas id="tempChart" height="240"></canvas>
    </div>
    <!-- <div class="row" style="justify-content:space-between;align-items:center;">
      <label for="temp_range" class="muted">Nhi·ªát ƒë·ªô:</label>
      <select id="temp_range" onchange="loadTemperatureChart()">
        <option value="day">Trong ng√†y</option>
        <option value="week">Trong tu·∫ßn</option>
        <option value="month">Trong th√°ng</option>
      </select>
    </div>
    <canvas id="tempChart" height="200"></canvas>

    <hr style="margin:20px 0;opacity:.2;">

    <div class="row" style="justify-content:space-between;align-items:center;">
      <label for="fan_range" class="muted">Ho·∫°t ƒë·ªông qu·∫°t:</label>
      <select id="fan_range" onchange="loadFanChart()">
        <option value="day">Trong ng√†y</option>
      </select>
    </div>
    <canvas id="fanChart" height="200"></canvas>
    </div> -->

  </section>

    <!-- PASSKEY TAB -->
    <section id="tab-passkey" class="active">
      <div class="card">
        <h2>M·ªü c·ª≠a b·∫±ng Passcode</h2>
        <!-- <div class="row"><input id="device_id" value="passkey_01" placeholder="device_id (v√≠ d·ª• passkey_01)"></div> -->
         <div class="row device-info">
            <label id="device_label">Thi·∫øt b·ªã: ‚Äî</label>
            <input id="device_id" type="hidden">
          </div>

        <div id="screen" class="screen">******</div>
        <div class="keys">
          <div class="key" onclick="tap('1')">1</div><div class="key" onclick="tap('2')">2</div><div class="key" onclick="tap('3')">3</div>
          <div class="key" onclick="tap('4')">4</div><div class="key" onclick="tap('5')">5</div><div class="key" onclick="tap('6')">6</div>
          <div class="key" onclick="tap('7')">7</div><div class="key" onclick="tap('8')">8</div><div class="key" onclick="tap('9')">9</div>
          <div class="key" onclick="delKey()">‚å´</div><div class="key" onclick="tap('0')">0</div><div class="key" onclick="clearKey()">C</div>
        </div>
        
        <div class="row">
          <button onclick="submitPasscode()">Enter</button>
          <div class="row" style="margin-top:12px">
            <button class="secondary" onclick="openManageModal()">Qu·∫£n l√Ω Passkey</button>
          </div>

          <span id="pass_inline" class="inline-status"></span>
        </div>

      </div>
      <div id="passkey_msg" class="passkey-message"></div> 
    </section>
    
    <!-- FAN TAB -->
    <section id="tab-fan" >
      <div class="card" id="fan_card">
        <h2>Qu·∫°t (Relay)</h2>
        <div class="row">
          <input id="fdev" value="fan_01" style="max-width:180px" placeholder="device_id">
          <div id="toggler" class="toggle" onclick="toggleFan()"><div class="knob"></div></div>
          <span id="fan_label" class="state-label">Off</span>
        </div>
        
      </div>
      <div id="fan_msg" class="fan-message"></div>
    </section>

    <!-- NOTIFY TAB -->
     <section id="tab-notify">
      <div class="card">
        <h2>Th√¥ng b√°o h√¥m nay</h2>
        <div class="row">
          <button onclick="loadFeed()">L√†m m·ªõi</button>
          <span class="muted">M·ªõi nh·∫•t ·ªü tr√™n ‚Ä¢ t·ª± l·ªçc theo ng√†y</span>
        </div>

        <table id="feed" class="table">
          <thead>
            <tr>
              <th>Thi·∫øt b·ªã</th>
              <!-- <th>L·ªánh</th> -->
              <th>K·∫øt qu·∫£</th>
              <th>Th·ªùi gian</th>
            </tr>
          </thead>
          <tbody id="feed-body">
            <tr><td colspan="4" class="muted">ƒêang t·∫£i...</td></tr>
          </tbody>
        </table>
      </div>
    </section>


    <!-- <section id="tab-notify">
      <div class="card">
        <h2>Th√¥ng b√°o h√¥m nay</h2>
        <div class="row">
          <button onclick="loadFeed()">L√†m m·ªõi</button>
          <span class="muted">M·ªõi nh·∫•t ·ªü tr√™n ‚Ä¢ 1 d√≤ng/th√¥ng b√°o ‚Ä¢ t·ª± l·ªçc theo ng√†y</span>
        </div>
        <div id="feed" class="feed"></div>
      </div>
    </section> -->

    <!-- RFID TAB -->
    <section id="tab-rfid">
  <div class="card">
    <h2>Qu·∫£n l√Ω th·∫ª RFID</h2>
    <button onclick="openAddRfid()" class="small-action">‚ûï Th√™m th·∫ª</button>
    <div id="rfid_msg" class="rfid-message"></div>

    <table class="table table-rfid">
      <thead>
        <tr>
          <th>UID</th>
          <th>Ng∆∞·ªùi d√πng</th>
          <th>Lo·∫°i th·∫ª</th>
          <th>M√¥ t·∫£</th>
          <th>Tr·∫°ng th√°i</th>
          <th>ƒêƒÉng k√Ω</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody id="rfid_card_table">
        <tr><td colspan="7" style="text-align:center">ƒêang t·∫£i...</td></tr>
      </tbody>
    </table>
  </div>
</section>


    <!-- HISTORY TAB -->
  
    <section id="tab-history">
  <div class="card">
    <h2>L·ªãch s·ª≠ v√†o/ra</h2>
    <button onclick="loadHistory()">üîÑ L√†m m·ªõi</button>
    <table class="table">
      <thead>
        <tr>
          <th>Thi·∫øt b·ªã</th>
          <th>K·∫øt qu·∫£</th>
          <th>Th·ªùi gian</th>
        </tr>
      </thead>
      <tbody id="history_table"></tbody>
    </table>

  </div>
</section>

<!-- ==== Qu·∫£n l√Ω Passkey ==== -->
  <div id="manage_full" class="modal-full">
    <header>
      <button class="back" onclick="closeManageFull()">‚Üê</button>
      <h3>Danh s√°ch Passkey</h3>
      <div style="width:24px"></div>
    </header>
    <div class="content">
      <button type="button" onclick="openAddPassFull()" style="width:100%;margin-bottom:10px;">+ Th√™m Passkey</button>
      <div id="passkey_list"></div>
    </div>
  </div>

<!-- ==== Th√™m / S·ª≠a Passkey ==== -->
  <div id="pass_edit_full" class="modal-full" style="display:none;">
  <header>
    <button class="back" onclick="closePassEditFull()">‚Üê</button>
    <h3 id="pass_edit_title">Th√™m Passkey</h3>
    <div style="width:24px"></div>
  </header>

  <div class="content">
    <input id="edit_pass_id" placeholder="ID (t·ª± sinh n·∫øu ƒë·ªÉ tr·ªëng)" readonly>

    <input id="edit_pass_value"
           type="password"
           placeholder="Passkey (6 ch·ªØ s·ªë)"
           maxlength="6"
           pattern="\d{6}"
           oninput="this.value=this.value.replace(/[^0-9]/g,'')">

    <input id="edit_owner" placeholder="User ID (Owner)" value="00002">

    <div class="row">
      <label style="display:flex;align-items:center;gap:6px">
        <input type="checkbox" id="edit_active" checked> K√≠ch ho·∫°t
      </label>
    </div>

    <textarea id="edit_desc" rows="2" placeholder="M√¥ t·∫£ (tu·ª≥ ch·ªçn)"></textarea>

    <label class="muted" for="edit_expires">Th·ªùi gian h·∫øt h·∫°n (tu·ª≥ ch·ªçn)</label>
    <input id="edit_expires" type="datetime-local">
  </div>

  <div class="actions">
    <button class="cancel" onclick="closePassEditFull()">Hu·ª∑</button>
    <button class="save" onclick="savePasskey()">L∆∞u</button>
  </div>
</div>


<!-- ==== X√°c nh·∫≠n Xo√° Passkey ==== -->
    <!-- X√°c nh·∫≠n x√≥a (popup nh·ªè) -->
<!-- Popup x√°c nh·∫≠n xo√° Passkey -->
<div id="confirm_backdrop_passkey" class="modal-backdrop-passkey">
  <div class="modal small">
    <h3>X√≥a passkey</h3>
    <p id="confirm_text_passkey" class="muted">B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a passkey n√†y?</p>
    <div class="modal-actions center">
      <button class="cancel" onclick="closeConfirmPasskey()">Hu·ª∑</button>
      <button class="danger" onclick="doDeletePasskey()">X√≥a</button>
    </div>
  </div>


</div>

  <div id="toast" class="toast"></div>

</div>
  <script src="/config.js"></script>
  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function toggleMenu() {
      document.getElementById('menu').classList.toggle('show');
    }

    // Khi click tab th√¨ ƒë√≥ng menu
    document.addEventListener('click', function(e) {
      const menu = document.getElementById('menu');
      const icon = document.querySelector('.menu-icon');
      if (!menu.contains(e.target) && !icon.contains(e.target)) {
        menu.classList.remove('show');
      }
      if (e.target.classList.contains('tab')) {
        menu.classList.remove('show');
      }
    });
    </script>






  </body>
  </html>
